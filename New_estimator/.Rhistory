source("VAR_func.R")
source("Cov_func.R")
library(matrixcalc)
set.seed(101)
Ess.cov.sig <- function(data){
    chain <- as.matrix(data)
    if(det(cov.sig(chain)$covariance) > 0){
        ess =  nrow(chain)*exp((log(det(var(chain))) - log(det(cov.sig(chain)$covariance)))/ncol(chain))
    }else{
        stop("covariance matrix is not positive definite")
    }
    return("ESS" = ess)
}
var_track <- function(N = 5e4, phi, omega, B = 10, level = .90)
{
    p <- dim(phi)[1]
    nloops <- 50
    subsize <- floor(seq(5e3, N, length = nloops))
    ess_track_lug <- matrix(0, nrow = B, ncol = length(subsize))
    ess_track_bm <- matrix(0, nrow = B, ncol = length(subsize))
    ess_track_wbm <- matrix(0, nrow = B, ncol = length(subsize))
    ess_track_cc <- matrix(0, nrow = B, ncol = length(subsize))
    
    colnames(ess_track_wbm) <- subsize
    colnames(ess_track_bm) <- subsize
    colnames(ess_track_lug) <- subsize
    colnames(ess_track_cc) <- subsize
    for(b in 1:B)
    {
        if(b %% 1 ==0) print(b)
        chain <- var1(p = p, phi = phi, nsim = N, omega = omega)
        for(j in 1:length(subsize))
        {
            print(j)
            minichain <- chain[1:subsize[j], ]
            ess_track_bm[b, j] <- multiESS(minichain, r = 1, method = "bm", adjust = TRUE)/subsize[j]
            ess_track_wbm[b,j] <- multiESS(minichain, r = 2, method = "bm", adjust = TRUE)/subsize[j]
            ess_track_lug[b,j] <- multiESS(minichain, r = 3, method = "bm", adjust = TRUE)/subsize[j]
            ess_track_cc[b,j] <- Ess.cov.sig(minichain)/subsize[j]
        }
    }
    return(list("BM" = ess_track_bm, "WBM" = ess_track_wbm, "LUG" = ess_track_lug, "CC" = ess_track_cc))
}
p <- 10
phi <- diag(rep(.95,p))
omega <- matrix(.9, nrow = p, ncol = p)
diag(omega) <- 1
omega <- omega^(abs(col(omega)-row(omega)))
truth <- true.sig(p = p, omega = omega, phi = phi)
ess_true <- (det(truth$tar.var)/det(truth$final.cov))^(1/p)
ess_track <- var_track(N = 5e4, phi = phi, omega = omega, B = 10)
nloops <- 50
subsize <- seq(5e3, 5e4, length = nloops)
save(subsize, ess_true, ess_track, file = "ESS_data.Rdata")
load("ESS_data.Rdata")
se_ess_bm <- apply(ess_track$BM, 2, sd)/sqrt(nloops)
se_ess_wbm <- apply(ess_track$WBM, 2, sd)/sqrt(nloops)
se_ess_lug <- apply(ess_track$LUG, 2, sd)/sqrt(nloops)
se_ess_cc <- apply(ess_track$CC, 2, sd)/sqrt(nloops)
pdf("plots/var_ess.pdf", height = 6, width = 6)
par(mar = c(5.1, 4.8, 4.1, 2.1))
plot(subsize, colMeans(ess_track$BM), ylim = c(.0242, .031), 
    type = 'l', xlab = "Time", ylab = expression(hat(ESS)/n))
segments(x0 = subsize, y0 = colMeans(ess_track$BM) - 1.96*se_ess_bm, y1 = colMeans(ess_track$BM) + 1.96*se_ess_bm)
lines(subsize,colMeans(ess_track$WBM), col = "blue" )
segments(x0 = subsize, y0 = colMeans(ess_track$WBM) - 1.96*se_ess_wbm, y1 = colMeans(ess_track$WBM) + 1.96*se_ess_wbm, col = "blue")
lines(subsize,colMeans(ess_track$LUG), col = "red" )
segments(x0 = subsize, y0 = colMeans(ess_track$LUG) - 1.96*se_ess_lug, y1 = colMeans(ess_track$LUG) + 1.96*se_ess_lug, col = "red")
lines(subsize,colMeans(ess_track$CC), col = "purple" )
segments(x0 = subsize, y0 = colMeans(ess_track$CC) - 1.96*se_ess_CC, y1 = colMeans(ess_track$CC) + 1.96*se_ess_CC, col = "purple")
abline(h = ess_true, lty = 2)
legend("topright", bty = "n",legend = c("BM", "Zero Lugsail", "CC", "Over Lugsail"), col = c("black", "blue", "purple", "red"), lty = 1)
dev.off()
load("ESS_data.Rdata")
se_ess_bm <- apply(ess_track$BM, 2, sd)/sqrt(nloops)
se_ess_wbm <- apply(ess_track$WBM, 2, sd)/sqrt(nloops)
se_ess_lug <- apply(ess_track$LUG, 2, sd)/sqrt(nloops)
se_ess_cc <- apply(ess_track$CC, 2, sd)/sqrt(nloops)
pdf("plot_ess.pdf", height = 6, width = 6)
par(mar = c(5.1, 4.8, 4.1, 2.1))
plot(subsize, colMeans(ess_track$BM), ylim = c(.0242, .031), 
    type = 'l', xlab = "Time", ylab = expression(hat(ESS)/n))
segments(x0 = subsize, y0 = colMeans(ess_track$BM) - 1.96*se_ess_bm, y1 = colMeans(ess_track$BM) + 1.96*se_ess_bm)
lines(subsize,colMeans(ess_track$WBM), col = "blue" )
segments(x0 = subsize, y0 = colMeans(ess_track$WBM) - 1.96*se_ess_wbm, y1 = colMeans(ess_track$WBM) + 1.96*se_ess_wbm, col = "blue")
lines(subsize,colMeans(ess_track$LUG), col = "red" )
segments(x0 = subsize, y0 = colMeans(ess_track$LUG) - 1.96*se_ess_lug, y1 = colMeans(ess_track$LUG) + 1.96*se_ess_lug, col = "red")
lines(subsize,colMeans(ess_track$CC), col = "purple" )
segments(x0 = subsize, y0 = colMeans(ess_track$CC) - 1.96*se_ess_cc, y1 = colMeans(ess_track$CC) + 1.96*se_ess_cc, col = "purple")
abline(h = ess_true, lty = 2)
legend("topright", bty = "n",legend = c("BM", "Zero Lugsail", "CC", "Over Lugsail"), col = c("black", "blue", "purple", "red"), lty = 1)
dev.off()
load("ESS_data.Rdata")
se_ess_bm <- apply(ess_track$BM, 2, sd)/sqrt(nloops)
se_ess_wbm <- apply(ess_track$WBM, 2, sd)/sqrt(nloops)
se_ess_lug <- apply(ess_track$LUG, 2, sd)/sqrt(nloops)
se_ess_cc <- apply(ess_track$CC, 2, sd)/sqrt(nloops)
pdf("plot_ess.pdf", height = 6, width = 6)
par(mar = c(5.1, 4.8, 4.1, 2.1))
plot(subsize, colMeans(ess_track$BM), ylim = c(.0242, .1), 
    type = 'l', xlab = "Time", ylab = expression(hat(ESS)/n))
segments(x0 = subsize, y0 = colMeans(ess_track$BM) - 1.96*se_ess_bm, y1 = colMeans(ess_track$BM) + 1.96*se_ess_bm)
lines(subsize,colMeans(ess_track$WBM), col = "blue" )
segments(x0 = subsize, y0 = colMeans(ess_track$WBM) - 1.96*se_ess_wbm, y1 = colMeans(ess_track$WBM) + 1.96*se_ess_wbm, col = "blue")
lines(subsize,colMeans(ess_track$LUG), col = "red" )
segments(x0 = subsize, y0 = colMeans(ess_track$LUG) - 1.96*se_ess_lug, y1 = colMeans(ess_track$LUG) + 1.96*se_ess_lug, col = "red")
lines(subsize,colMeans(ess_track$CC), col = "purple" )
segments(x0 = subsize, y0 = colMeans(ess_track$CC) - 1.96*se_ess_cc, y1 = colMeans(ess_track$CC) + 1.96*se_ess_cc, col = "purple")
abline(h = ess_true, lty = 2)
legend("topright", bty = "n",legend = c("BM", "Zero Lugsail", "CC", "Over Lugsail"), col = c("black", "blue", "purple", "red"), lty = 1)
dev.off()
load("ESS_data.Rdata")
se_ess_bm <- apply(ess_track$BM, 2, sd)/sqrt(nloops)
se_ess_wbm <- apply(ess_track$WBM, 2, sd)/sqrt(nloops)
se_ess_lug <- apply(ess_track$LUG, 2, sd)/sqrt(nloops)
se_ess_cc <- apply(ess_track$CC, 2, sd)/sqrt(nloops)
pdf("plot_ess.pdf", height = 6, width = 6)
par(mar = c(5.1, 4.8, 4.1, 2.1))
plot(subsize, colMeans(ess_track$BM), ylim = c(.0242, .045), 
    type = 'l', xlab = "Time", ylab = expression(hat(ESS)/n))
segments(x0 = subsize, y0 = colMeans(ess_track$BM) - 1.96*se_ess_bm, y1 = colMeans(ess_track$BM) + 1.96*se_ess_bm)
lines(subsize,colMeans(ess_track$WBM), col = "blue" )
segments(x0 = subsize, y0 = colMeans(ess_track$WBM) - 1.96*se_ess_wbm, y1 = colMeans(ess_track$WBM) + 1.96*se_ess_wbm, col = "blue")
lines(subsize,colMeans(ess_track$LUG), col = "red" )
segments(x0 = subsize, y0 = colMeans(ess_track$LUG) - 1.96*se_ess_lug, y1 = colMeans(ess_track$LUG) + 1.96*se_ess_lug, col = "red")
lines(subsize,colMeans(ess_track$CC), col = "purple" )
segments(x0 = subsize, y0 = colMeans(ess_track$CC) - 1.96*se_ess_cc, y1 = colMeans(ess_track$CC) + 1.96*se_ess_cc, col = "purple")
abline(h = ess_true, lty = 2)
legend("topright", bty = "n",legend = c("BM", "Zero Lugsail", "CC", "Over Lugsail"), col = c("black", "blue", "purple", "red"), lty = 1)
dev.off()
minichain <- var1(p = 2, phi = phi, nsim = N, omega = omega)
N = 1e5
minichain <- var1(p = 2, phi = phi, nsim = N, omega = omega)
N = 1e5; p = 2
minichain <- var1(p = 2, phi = phi, nsim = N, omega = omega)
phi <- diag(rep(.95,p))
omega <- matrix(.9, nrow = p, ncol = p)
minichain <- var1(p = 2, phi = phi, nsim = N, omega = omega)
multiESS(minichain, covmat = mcse.initseq(minichain)$cov)
library(mcmcse)
minichain <- var1(p = 2, phi = phi, nsim = N, omega = omega)
multiESS(minichain, covmat = mcse.initseq(minichain)$cov)
source("VAR_ess.R")
p <- 10
phi <- diag(rep(.95,p))
omega <- matrix(.9, nrow = p, ncol = p)
diag(omega) <- 1
omega <- omega^(abs(col(omega)-row(omega)))
truth <- true.sig(p = p, omega = omega, phi = phi)
ess_true <- (det(truth$tar.var)/det(truth$final.cov))^(1/p)
ess_track <- var_track(N = 5e4, phi = phi, omega = omega, B = 10)
nloops <- 50
subsize <- seq(5e3, 5e4, length = nloops)
# plot(subsize, colMeans(ess_track$BM), type= 'l', ylim = range(ess_track))
# lines(subsize, colMeans(ess_track$WBM), col = "red")
# lines(subsize, colMeans(ess_track$LUG), col = "blue")
# abline(h = ess_true)
save(subsize, ess_true, ess_track, file = "ESS_data.Rdata")
load("ESS_data.Rdata")
se_ess_bm <- apply(ess_track$BM, 2, sd)/sqrt(nloops)
se_ess_wbm <- apply(ess_track$WBM, 2, sd)/sqrt(nloops)
se_ess_lug <- apply(ess_track$LUG, 2, sd)/sqrt(nloops)
se_ess_cc <- apply(ess_track$CC, 2, sd)/sqrt(nloops)
se_ess_ise <- apply(ess_track$ISE, 2, sd)/sqrt(nloops)
pdf("plot_ess.pdf", height = 6, width = 6)
par(mar = c(5.1, 4.8, 4.1, 2.1))
plot(subsize, colMeans(ess_track$BM), ylim = c(.0242, .045), 
    type = 'l', xlab = "Time", ylab = expression(hat(ESS)/n))
segments(x0 = subsize, y0 = colMeans(ess_track$BM) - 1.96*se_ess_bm, y1 = colMeans(ess_track$BM) + 1.96*se_ess_bm)
lines(subsize,colMeans(ess_track$WBM), col = "blue" )
segments(x0 = subsize, y0 = colMeans(ess_track$WBM) - 1.96*se_ess_wbm, y1 = colMeans(ess_track$WBM) + 1.96*se_ess_wbm, col = "blue")
lines(subsize,colMeans(ess_track$LUG), col = "red" )
segments(x0 = subsize, y0 = colMeans(ess_track$LUG) - 1.96*se_ess_lug, y1 = colMeans(ess_track$LUG) + 1.96*se_ess_lug, col = "red")
lines(subsize,colMeans(ess_track$CC), col = "purple" )
segments(x0 = subsize, y0 = colMeans(ess_track$CC) - 1.96*se_ess_cc, y1 = colMeans(ess_track$CC) + 1.96*se_ess_cc, col = "purple")
lines(subsize,colMeans(ess_track$ISE), col = "green" )
segments(x0 = subsize, y0 = colMeans(ess_track$ISE) - 1.96*se_ess_ise, y1 = colMeans(ess_track$ISE) + 1.96*se_ess_ise, col = "green")
abline(h = ess_true, lty = 2)
legend("topright", bty = "n",legend = c("BM", "Zero Lugsail", "CC", "Over Lugsail", "ISE"), col = c("black", "blue", "purple", "red", "green"), lty = 1)
dev.off()
load("ESS_data.Rdata")
se_ess_bm <- apply(ess_track$BM, 2, sd)/sqrt(nloops)
se_ess_wbm <- apply(ess_track$WBM, 2, sd)/sqrt(nloops)
se_ess_lug <- apply(ess_track$LUG, 2, sd)/sqrt(nloops)
se_ess_cc <- apply(ess_track$CC, 2, sd)/sqrt(nloops)
se_ess_ise <- apply(ess_track$ISE, 2, sd)/sqrt(nloops)
pdf("plot_ess.pdf", height = 6, width = 6)
par(mar = c(5.1, 4.8, 4.1, 2.1))
plot(subsize, colMeans(ess_track$BM), 
    type = 'l', xlab = "Time", ylab = expression(hat(ESS)/n))
segments(x0 = subsize, y0 = colMeans(ess_track$BM) - 1.96*se_ess_bm, y1 = colMeans(ess_track$BM) + 1.96*se_ess_bm)
lines(subsize,colMeans(ess_track$WBM), col = "blue" )
segments(x0 = subsize, y0 = colMeans(ess_track$WBM) - 1.96*se_ess_wbm, y1 = colMeans(ess_track$WBM) + 1.96*se_ess_wbm, col = "blue")
lines(subsize,colMeans(ess_track$LUG), col = "red" )
segments(x0 = subsize, y0 = colMeans(ess_track$LUG) - 1.96*se_ess_lug, y1 = colMeans(ess_track$LUG) + 1.96*se_ess_lug, col = "red")
lines(subsize,colMeans(ess_track$CC), col = "purple" )
segments(x0 = subsize, y0 = colMeans(ess_track$CC) - 1.96*se_ess_cc, y1 = colMeans(ess_track$CC) + 1.96*se_ess_cc, col = "purple")
lines(subsize,colMeans(ess_track$ISE), col = "green" )
segments(x0 = subsize, y0 = colMeans(ess_track$ISE) - 1.96*se_ess_ise, y1 = colMeans(ess_track$ISE) + 1.96*se_ess_ise, col = "green")
abline(h = ess_true, lty = 2)
legend("topright", bty = "n",legend = c("BM", "Zero Lugsail", "CC", "Over Lugsail", "ISE"), col = c("black", "blue", "purple", "red", "green"), lty = 1)
dev.off()
load("ESS_data.Rdata")
se_ess_bm <- apply(ess_track$BM, 2, sd)/sqrt(nloops)
se_ess_wbm <- apply(ess_track$WBM, 2, sd)/sqrt(nloops)
se_ess_lug <- apply(ess_track$LUG, 2, sd)/sqrt(nloops)
se_ess_cc <- apply(ess_track$CC, 2, sd)/sqrt(nloops)
se_ess_ise <- apply(ess_track$ISE, 2, sd)/sqrt(nloops)
pdf("plot_ess.pdf", height = 6, width = 6)
par(mar = c(5.1, 4.8, 4.1, 2.1))
plot(subsize,colMeans(ess_track$ISE), col = "green" )
segments(x0 = subsize, y0 = colMeans(ess_track$ISE) - 1.96*se_ess_ise, y1 = colMeans(ess_track$ISE) + 1.96*se_ess_ise, col = "green")
lines(subsize, colMeans(ess_track$BM), 
    type = 'l', xlab = "Time", ylab = expression(hat(ESS)/n))
segments(x0 = subsize, y0 = colMeans(ess_track$BM) - 1.96*se_ess_bm, y1 = colMeans(ess_track$BM) + 1.96*se_ess_bm)
lines(subsize,colMeans(ess_track$WBM), col = "blue" )
segments(x0 = subsize, y0 = colMeans(ess_track$WBM) - 1.96*se_ess_wbm, y1 = colMeans(ess_track$WBM) + 1.96*se_ess_wbm, col = "blue")
lines(subsize,colMeans(ess_track$LUG), col = "red" )
segments(x0 = subsize, y0 = colMeans(ess_track$LUG) - 1.96*se_ess_lug, y1 = colMeans(ess_track$LUG) + 1.96*se_ess_lug, col = "red")
lines(subsize,colMeans(ess_track$CC), col = "purple" )
segments(x0 = subsize, y0 = colMeans(ess_track$CC) - 1.96*se_ess_cc, y1 = colMeans(ess_track$CC) + 1.96*se_ess_cc, col = "purple")
abline(h = ess_true, lty = 2)
legend("topright", bty = "n",legend = c("BM", "Zero Lugsail", "CC", "Over Lugsail", "ISE"), col = c("black", "blue", "purple", "red", "green"), lty = 1)
dev.off()
ess_track
p <- 10
phi <- diag(rep(.95,p))
omega <- matrix(.9, nrow = p, ncol = p)
diag(omega) <- 1
omega <- omega^(abs(col(omega)-row(omega)))
truth <- true.sig(p = p, omega = omega, phi = phi)
ess_true <- (det(truth$tar.var)/det(truth$final.cov))^(1/p)
minichain <- var1(p = p, phi = phi, nsim = N, omega = omega)
ess_track_cc <- Ess.cov.sig(minichain)/N
ess_track_cc
source("VAR_ess.R")
p <- 10
phi <- diag(rep(.95,p))
omega <- matrix(.9, nrow = p, ncol = p)
diag(omega) <- 1
omega <- omega^(abs(col(omega)-row(omega)))
truth <- true.sig(p = p, omega = omega, phi = phi)
ess_true <- (det(truth$tar.var)/det(truth$final.cov))^(1/p)
ess_track <- var_track(N = 5e4, phi = phi, omega = omega, B = 10)
q()
